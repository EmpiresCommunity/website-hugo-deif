<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge,chrome=1"><link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel=stylesheet><link rel=stylesheet href=https://unpkg.com/bulmaswatch/darkly/bulmaswatch.min.css media=screen><link rel=stylesheet href=https://www.empiresmod.com/style.main.min.5f0bbd0872bea5a1974662fb6cc58334167574a4cd2c3f619d5c363a792f1752.css media=screen><meta property="og:title" content="Ежемесячный отчёт о разработке Empires UE4  - Июнь 2021"><meta property="og:description" content="Модели техники Mayama Мне удалось сделать все оставшиеся модели техники СФ. Как всегда, без микро-деталей по типу заклёпок, болтов и прочего, я добавлю их, когда мы на 100% будем уверены, что модель мы не поменяем. А ещё с подвеской и рулём в этот раз, потому что, давайте будем честны, без этого он выглядит как корыто.
Новый джип СФ. Я хотел сделать что-то среднее между реалистичным военным багги и Mad Max (без шипов)."><meta property="og:type" content="article"><meta property="og:url" content="https://www.empiresmod.com/ru/posts/unreal-progress-report-june-2021/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-07-04T00:00:00+00:00"><meta property="article:modified_time" content="2021-07-04T00:00:00+00:00"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bulma-carousel@4.0.4/dist/css/bulma-carousel.min.css><title>Ежемесячный отчёт о разработке Empires UE4 - Июнь 2021 &ndash; Empires</title><link rel=icon type=image/png href=https://www.empiresmod.com//images/favicon.png></head><body><div class=wrapper><nav id=navbar class="navbar offset-top is-fixed-top" role=navigation aria-label="main navigation"><div class=container><div class=navbar-brand><a class=navbar-item href=https://www.empiresmod.com/><img src=https://www.empiresmod.com//images/logo.png></a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=navbarBasicExample><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a></div><div id=navbarBasicExample class=navbar-menu><div class=navbar-start><a class=navbar-item href=https://www.empiresmod.com/>Empires</a><div class="navbar-item has-dropdown is-hoverable"><a class=navbar-link>Meet Players</a><div class="navbar-dropdown is-boxed"><a class=navbar-item href=https://discord.gg/UH6Sc6B>Chat on Discord</a>
<a class=navbar-item href=https://steamdb.info/app/17740/graphs/>Current player count</a>
<a class=navbar-item href=https://steamcommunity.com/app/17740>Steam community hub</a></div></div><div class="navbar-item has-dropdown is-hoverable"><a class=navbar-link>Learn</a><div class="navbar-dropdown is-boxed"><span class=navbar-item>TEXT TUTORIALS</span>
<a class=navbar-item href=https://www.empiresmod.com/docs/quickstart/quick_start.html>Quick-start guide</a>
<a class=navbar-item href=https://www.empiresmod.com/docs/index.htm>Manual</a><hr class=navbar-divider><span class=navbar-item>ADVANCED TOPICS</span>
<a class=navbar-item href=https://wiki.empiresmod.com/Main_Page>Wiki</a>
<a class=navbar-item href=https://wiki.empiresmod.com/Dedicated_Server_Setup>Server setup</a></div></div><div class="navbar-item has-dropdown is-hoverable"><a class=navbar-link>Developers</a><div class="navbar-dropdown is-boxed"><a class=navbar-item href=https://www.empiresmod.com/team>About Us</a><hr class=navbar-divider><span class=navbar-item>DEVELOPER BLOGS</span>
<a class=navbar-item href=https://www.empiresmod.com/tags/source>Source Engine</a>
<a class=navbar-item href=https://www.empiresmod.com/tags/unrealengine>Unreal Engine</a></div></div></div></div></div></nav><div class=main><div class=grow-content><div class=container><div class=content><section class=post-content><h1>Ежемесячный отчёт о разработке Empires UE4 - Июнь 2021</h1><div class=post_meta><img class="icon date" src=https://www.empiresmod.com//images/calendar-month.png>
<span class=post_date>Sunday, 4 July 2021</span>
<span>- Tags: </span><span><a href=https://www.empiresmod.com/ru/tags/unrealengine title=UNREALENGINE class="tag button">UNREALENGINE</a></span></div>Available in
<span><a class=translation-link href=https://www.empiresmod.com/posts/unreal-progress-report-june-2021/>English</a>
<a class=translation-link href=https://www.empiresmod.com/ru/posts/unreal-progress-report-june-2021/>русский</a></span><h2 id=модели-техники>Модели техники</h2><h6 id=mayama>Mayama</h6><p>Мне удалось сделать все оставшиеся модели техники СФ. Как всегда, без микро-деталей по типу заклёпок, болтов и прочего, я добавлю их, когда мы на 100% будем уверены, что модель мы не поменяем. А ещё с подвеской и рулём в этот раз, потому что, давайте будем честны, без этого он выглядит как корыто.</p><p><img src=images/image9.png alt=alt_text title=image_tooltip></p><p>Новый джип СФ. Я хотел сделать что-то среднее между реалистичным военным багги и Mad Max (без шипов). Он массивнее, чем джип из Source Empires, но если вы хотите сделать что-то лучше коробки с 4-мя колесами, вам нужно больше места.</p><p><img src=images/image1.png alt=alt_text title=image_tooltip></p><p>Модель БТРа. В Source версии единственными моделями СФ с 6-ю колёсами были командирская машина и лёгкий танк. Мне хотелось преодолеть разрыв между ЛТ и остальной обычной техникой. Цель дизайна состояла в том, чтобы создать нечто среднее между дизайном ЛТ и остальными танками. Старый БТР СФ был по сути просто минивэном к которому привинтили случайные штуки. Я хотел создать модель БТР, которая выглядела бы так, будто ее в самом деле можно победить.</p><p><img src=images/image8.png alt=alt_text title=image_tooltip></p><p>Новая “Артиллерия”. В кавычках, потому что идея заключается в том, что вы можете снять башню и поставить на её место зенитную или любую другую, так нам не придётся создавать отдельную модель для зенитки. Я сделал его похожим на тяжелый грузовик или трактор, что СФ переделали для войны, и прикрепили платформу взади. Это не фронтовая машина, поэтому она не такая бронированная, как остальные.</p><p><img src=images/image3.png alt=alt_text title=image_tooltip></p><p>Средний танк СФ. Я перепробовал множество вещей, что были ближе к дизайну Первой Мировой из моделей Source Empires, но вы либо получаете что-то слишком большое (как в Source Empires), либо оно выглядит как чёртова коробка с гусеницами. Поэтому, немного пошибуршив с этим, я выбрал дизайн ближе к Второй Мировой. Не смотря на это, общий “дизайн” СФ, заключающийся в том, что к чему-то лепят миллион вещей, остался. Он примерно того же размера, что и СТ БЕ, который я показывал в последнем обновлении, но немного выше и короче.</p><p><img src=images/image5.png alt=alt_text title=image_tooltip></p><p>Тяжёлый танк СФ. Он очень большой, как я и говорил в своем последнем обновлении. Мы хотим сделать тяжей особенными, необычными, редкими на поле боя. Игроки должны бояться при виде тяжёлого танка. Двойная ракетная установка встроена в корпус, а отверстие на переднем щитке - это место, откуда ракета вылетает из башни. У него по два трака на сторону для поддержки его внушительного веса.</p><p><img src=images/image7.png alt=alt_text title=image_tooltip></p><p>Командирская машина (КМ) СФ . Передвижная база миссии СФ . Мне хотелось создать что-то выглядящее более зловеще, чем бестолковая КМ СФ из Source Empires. Она имеет 3 гидравлических ножки с каждой стороны, которые выдвигаются, когда командир находится в режиме RTS. Это не меняет игровой процесс, цель такова, чтобы дать знать врагам, когда командир на самом деле управляет КМ и когда можно безопасно приближаться к машине. На машине есть две вещи представляющие функции, которые могут быть реализованы после 1.0. 6 пусковых установок с дронами, что могут ремонтировать и строить в небольшом радиусе вокруг КМ. Маленькая башня является зенитной пушкой, она служит средством ПВО для КМ, иначе один единственный самолет мог бы охотиться за КМ по всей карте.</p><p>И наконец, пара картинок для сравнения габаритов:</p><div class="columns triple-image"><div class=column><a href=/ru/posts/unreal-progress-report-june-2021/images/image6.png target=_blank><img src=/ru/posts/unreal-progress-report-june-2021/images/image6_hue2a8ebb93dbdc4a67ebbed65bbc6b3ad_583009_300x300_fill_q100_lanczos_smart1_3.png width=300 height=300></a></div><div class=column><a href=/ru/posts/unreal-progress-report-june-2021/images/image4.png target=_blank><img src=/ru/posts/unreal-progress-report-june-2021/images/image4_hube3423fb726bc4eacd4495c263723ead_434278_300x300_fill_q100_lanczos_smart1_3.png width=300 height=300></a></div><div class=column><a href=/ru/posts/unreal-progress-report-june-2021/images/image2.png target=_blank><img src=/ru/posts/unreal-progress-report-june-2021/images/image2_hud3120923e603d2b2798b0f3f24b73824_511547_300x300_fill_q100_lanczos_smart1_3.png width=300 height=300></a></div></div><h2 id=ecs-bullets---обзор>ECS Bullets - Обзор</h2><h6 id=megafunk>Megafunk</h6><p>В нашем последнем обновлении мы кратко упомянули о создании высокопроизводительной системы “ECS Bullets”. Мы в самом деле занимаемся этим, поэтому я расскажу более подробно о том, что уже готово.</p><p>В Unreal Engine 4, если вы рассмотрите существующие решения для симулирования снаряда то обнаружите основную мудрость, она состоит в том, чтобы создать объект “Actor” Unreal Engine для каждой выпущенной пули с прикрепленным кодом симулирования. Использование Actor&rsquo;ов работает достаточно хорошо для большинства игр, потому что их проблемы на самом деле не возникают до тех пор, пока вам не придется симулировать сотни вещей за кадр.</p><p>Существует множество трюков для борьбы с проблемами производительности Actor&rsquo;а. Большинство из них включают повторное использование actor&rsquo;ов при спавне или создании менеджера, который помечает actor&rsquo;ов в группах или только каждые несколько кадров. Все это немного помогает, но суть проблемы в том, что Actor&rsquo;ы UE4 по-прежнему просто затратно отмечать и перемещать. Почему они такие медленные? Короткий ответ заключается в том, что стоимость перемещения памяти в процессор и из него намного выше, чем любая работа по симуляции, которую фактически выполняет ваш код. Система UE4 gameplay framework очень “объектно-ориентирована”, что означает, что она использует огромную иерархию классов, чтобы выразить, что есть что. Когда все идет своим чередом, процессору приходится тратить дополнительное время на поиск инструкций и данных, которые хранятся в памяти в значительной степени случайным образом.</p><p>Чтобы создать код без этой проблемы, мы должны мыслить “ориентированно на данные". Это значит, что мы должны подумать о том, как мы храним нашу память (как данные, так и инструкции), и убедиться, что процессор всегда имеет под рукой то, что ему нужно. Короче говоря, наличие массивов простых данных, с которыми вы работаете одновременно, делает это очень простым. Это и делает Entity Component System! Мы используем стороннюю программу, написанную на C, под названием FLECS. Это инструмент позволяет легко сопоставлять гигантские массивы данных с кодом симуляции. Вот краткое изложение:</p><p>Entity: уникальный ID, который может содержать компоненты</p><p>Component: просто сырые данные (Position, Velocity и т.д.)</p><p>System: запрос для определенного набора компонентов для работы с инструкциями</p><p>Вы создаете Энтити с компонентами, и ECS автоматически отправляет его в соответствующие системы, чтобы сообщить им, что делать. Так, например, наши пули могут просто иметь Position, Velocity и BulletType. Система для перемещения каждой пули вперед может просто принимать Position и Velocity, чтобы продвинуть Position вперед c помощью Velocity. У нас есть выходит 2-е интересные вещи: об этом просто рассуждать, и это отлично подходит для производительности процессора.</p><p>Сейчас пули работают через Raycast, просчитывая свой путь в воздухе каждый кадр, пока не попадут во что-нибудь. Эти Raycast&rsquo;ы являются теми же самыми, что используются внутри для физики UE4, и их дешево делать в массовом количестве. Мы даже можем легко сделать это дело мультипоточным, поскольку работа довольно самодостаточна по компонентам энтити.</p><p>Ну а теперь, как заставить UE4 рендерить их? В мире UE4 particle system должны быть сами actor&rsquo;ы, поэтому было бы неправильно иметь по одному для каждой пули. Я решил создать систему “менеджера” частиц, которая представляет собой одну particle system, которая может поддерживать тысячи пуль одновременно. Система FLECS запрашивает пули, что соединены с энтити “менеджера” частиц, и создает массив значений позиций, которые она заносит в “менеджер” каждый кадр.</p><p>В результате производительность на порядок выше, чем при “обычном” методе создания пуль, как по времени спавна, так и по скорости симулирования. Я сомневаюсь, что в Empires когда-либо будет летать 30 000 пуль одновременно, но с этим у нас будет несколько больше свободы в нашем бюджете кадров.</p><h2 id=ecs-bullets---нетворкинг>ECS Bullets - Нетворкинг</h2><h6 id=roy-awesome>Roy Awesome</h6><p>Я довольно много работал над нетворкингом ECS Bullets, чтобы каждый игрок мог их видеть. Это оказалось довольно массивной кроличьей норой в стеке нетворкинга UE, и я построил довольно классную систему для обыкновенной репликации пуль клиентам.</p><p>В Unreal Engine есть система под названием “Data Channel”, которая может формировать сетевые пакеты и отправлять их клиентам. Создание одного из них довольно сложно и заняло довольно много времени, но теперь я могу просто отправлять энтити ECS и пули клиентам. Я также рассмотрел методы прогнозирования пуль, создавая энтити на клиенте и отправляя ключ на сервер, который отправляет его обратно с пулей, подтверждающей полномочия сервера.</p><p>В течение следующего месяца я планирую доработать сетевой код для пуль, а затем интегрировать эти пули в наши возможности стрельбы.</p><h2 id=ecs-bullets---open-source>ECS Bullets - Open Source</h2><h6 id=roy-awesome-1>Roy Awesome</h6><p>Проект Empires Unreal получил большую пользу от Open Source сообщества, окружающего Unreal Engine, и множество различных Open Source проектов внесли свой вклад в наше развитие. В попытке нарастить сообщество и немного расширить наш профиль, мы решили открыть исходный код плагина ECS Bullets под лицензией MIT.</p><p><a href=https://github.com/EmpiresCommunity/ECSProjectiles>https://github.com/EmpiresCommunity/ECSProjectiles</a></p><p>Скорее всего, это будет не последний раз для Empires-Unreal, когда мы открываем исходный код, так как мы очень заботимся о Open Source сообществе и очень гордимся тем, что вносим в него свой вклад.</p></section></div></div></div><footer class=footer><div class=container><div class=content><div class=columns><div class="column copyright"><div><img class=icon src=https://www.empiresmod.com//images/logo.png>EMPIRES</div><div>© Empires Mod 2023</div><div>All Rights Reserved</div></div><div class=column><div class=heading>SITE</div><div class=item><a href=https://www.empiresmod.com/team>About Us</a></div><div class=item><a href=https://www.empiresmod.com/posts>Developer Blog</a></div></div><div class=column><div class=heading>SOCIAL</div><div class=item><a href=https://twitter.com/empires_mod target=_blank><img class=icon src=https://www.empiresmod.com//images/twitter.png>Twitter</a></div><div class=item><a href=https://discord.gg/EXwY2X7 target=_blank><img class=icon src=https://www.empiresmod.com//images/discord.png>Discord</a></div><div class=item><a href=https://store.steampowered.com/app/17740/ target=_blank><img class=icon src=https://www.empiresmod.com//images/steam.png>Steam</a></div></div></div></div></div></footer></div></div><script src=https://www.empiresmod.com//js/main.js></script></body></html>